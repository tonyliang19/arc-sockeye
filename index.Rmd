---
title: "Introduction to Sockeye"
subtitle: "<br/>Adapted from UBC ARC Sockeye Workshop"
author: "Tony Liang"
institute: "University of British Columbia"
date: "Last modified -  `r Sys.Date()`"
---

```{r setup, include=FALSE, echo=FALSE}
source("rmd_config.R")
knitr::opts_chunk$set(eval=FALSE)
xaringanExtra::use_clipboard(
  button_text = "Copy",
  success_text = "Copied",
  error_text = "Press Ctrl + C to copy"
)
```

```{r css-extras, file="css-extras.R", echo=FALSE}
```

# Land acknowledgement

.pull-left[
**I would like to acknowledge that I work on the traditional, ancestral, and unceded territory of the Coast Salish Peoples, including the territories of the xwməθkwəy̓əm (Musqueam), Skwxwú7mesh (Squamish), Stó:lō and Səl̓ílwətaʔ/Selilwitulh (Tsleil- Waututh) Nations.**

*Traditional*: Traditionally used and/or occupied by Musqueam people

*Ancestral*: Recognizes land that is handed down from generation to generation

*Unceded*: Refers to land that was not turned over to the Crown (government) by a treaty or other agreement

]

.pull-right[
.center[<img src ="materials/img/land_acknowledgement.gif" alt="matrix", width="80%"/>]
]

---

class: top

# Topics

--

I'm being very extra to show what we are doing today **hopefully?**

.emphasis[
Prepare for the next 50 minutes, eat something, drink something, 

it's gonna be a heavy session.
]

--

.pull-left[
### Easy

- Linux and CLI
- Basic information of Sockeye
- Sockeye Login
]

--

.pull-right[
### Hard

- Setup SSH and VSCode
- Bashrc
- Job Submission
]

--

.secondary[About to start, make sure to follow along!]

.center[
`r pro`  .hand[FOLLOW ME]
`r con`  .hand[FOLLOW ME]
]

---

class: center, middle, inverse
.larger[.hand[FOLLOW ME]]

---

# Linux and CLI
.pull-left[
We will be using the .hand[famous] Linux system, where everything is going to be blacked out.

It is very cool once you are familiar at this.

`r pro` Command Line Interface (CLI)

`r con` Graphical User Interface (GUI)
]

.pull-right[
.secondary[Useful CL commands]
```bash
cd ~/path/to/dir/
cp ~/file/to/copy.md file/to/paste.md
cp -r ~/dir/to/copy/ dir/to/paste
ls -a # list all files (including hidden)
rm ~/file/to/delete.txt
```
]

--

.your-turn[
How do you delete a directory then?
]

--

.emphasis[
rm -r ~/dir/to/delete 
]

The `-r` flag means to be done recursively. Many linux commands have this flag, in the case of `rm`, it remove directories and their contents recursively.

---

# Linux and CLI

Note, there are cases that you want to delete directories where files are protected (like those of **git**)

Use the following with **CAUTION**:

--

.alert[
.large[`rm -rf ~/dir/to/delete/gone_is_gone`]
]

--

The `-f` flag tells to delete .hand[force] without confirmation. Be very careful on what are you deleting. 

You likely don't want to contact admin:
> You: Hey, I think I have deleted my $HOME directory
>
> Admin: .......
>

--

Don't .secondary[panic] either, you rarely can delete those directories.

---

# Linux and CLI

Most Linux commands have a built-in manual (man page) that serves as a quick guide to tell you what a command does. You could almost always type `command --help`.

Let's see an example
--

.pull-left[
```bash
ls --help
```

Seems scary right? I agree! `r pro`

But it gets better later, and let's dig more into its details. Look at the following:
.emphasis[
Usage: ls [OPTION] ... [FILE] ...
]

This part is where it tells you how you should use a command, what **possible** options it accepts

The [...] are .secondary[optional argument/s] and could be specified with the **flag** it takes. For example: `ls -a` or `ls --all` list **ALL** files of a directory.

]
.pull-right[
![](materials/img/help_usage.jpg)
]

---

.your-turn[

Try on any commands of your interest and look at its doc with `--help`

]

--
You could combine flags as well

```bash
ls -alh
```
Single letter flags **can** be combined together, BUT whole words .secondary[cannot] 

```bash
ls --all --human-readable -l
```
--

`r pro` Order of argument doesn't matter
`r pro` Short options can be combined together
`r pro` Try --help on a command that you don't know how to use
`r con` Long options cannot be combined together
`r con` Use -f flag wisely

--

.secondary[.larger[.center[Questions?]]]

---

# How to connect

Login to sockeye with:
```bash
# replace cwl with your actual cwl
# sockeye dynamically select one of three possible "login" nodes
ssh cwl@sockeye.arc.ubc.ca
```
- Upon login, you're on a `login` node
- You can run **short** interactive jobs there
- We will have an alias to do this later

But requires some configuration on your laptop/PC

--

<hr>

You could also login to specific login node:
```bash
# one of login01, login02, login03
ssh cwl@login03.sockeye.arc.ubc.ca
```
--

I rarely use this one ^

--

.emphasis[

You need to have an IP address from UBC, either by connected to UBC Wifi or VPN

]


---

# Basic Information of Sockeye

**Sockeye** is a High Performance Computing (HPC) platform, use it to run .secondary[large] computational analysis or works here.

--

- It uses .secondary[PBS Pro], Compute Canada uses .secondary[Slurm]

- Although requires knowledge to **Linux and CLI**

- You have different **nodes** on Sockeye

--

.pull-left[

.secondary[Login Nodes]

- Where you land after `ssh`
- Has internet access
- You spend **MOST** time here
]

.pull-right[

.secondary[Compute Nodes]

- "You don't do much on here"
- Do not have internet access
- There's an interactive type of this

]

--

.emphasis[
  You could `echo $HOSTNAME` to verify if you are in a login node
]

---

class: middle, center
background-image: url(materials/img/arc-structure.jpg)
background-size: contain

???

Explain what each node is, and the workflow

---

## Directories on Sockeye
.pull-left[
![:scale 90%](materials/img/arc-dir.png)
]
.pull-right[
![:scale 90%](materials/img/ro-dir.png)
]
--
.pull-left[   
#### /home
- The place you land after `ssh`, equivalent to `~`
- Only the **$USER** has access


.emphasis[
Recommend storing these as **ENV** variables, more on this later.
]

]

.pull-right[
#### **/project**
- Store your data, containers here
- Do not store intermediate results here

#### **/scratch**
- Playground space, widely used in compute node
- Your intermediate results should be written here
- .secondary[Try not storing huge stuff here]

]

???

These are soft links of directories, its actual path is different, demo it

---

Try on it and explore through actual coding!
--

1. First setup `ENV` variables,  .alert[This is only valid for current bash session]

  - we need to configure the `.bashrc` to make it    work all time. .secondary[Show you later]

  ```bash
  export ALLOC=st-singha53-1
  export SCRATCH_PATH=/scratch/$ALLOC/$USER
  export PROJECT_PATH=/arc/project/$ALLOC/$USER
  ```
--

1. Print these `PATH` variables out to get its path, and `cd` into them
  - You could name them differently later

  ```bash
  echo $SCRATCH_PATH && echo $PROJECT_PATH
  ```
  ```bash
  cd $SCRATCH_PATH && ls -a
  ```
  ```bash
  cd $PROJECT_PATH && ls -a
  ```
  - The `&&` is .secondary[AND ] operator in **shell**
--

1. This one is more sockeye-specific to check spaces allocated to you
  ```bash
  print_quota
  ```
---
class: middle, center
.secondary[.larger[.center[Questions?]]]

---

# Bashrc

- We mentioned earlier, that the `export ...` is only valid for the current bash session
- once you log-out, it's gone

--

<hr>

.pull-left[

- You need to add this to the `.bashrc` or `.bash_profile` located in the root path `~`
- These are places where you store configurations
]

.pull-right[

- `r pro` .primary[With suitable configs, Linux >> Mac >> Windows]
- `r con` .secondary[Without configs, Linux sucks]
- `r con` .secondary[It's HARD to setup the configs, it will get better]
]

--
.center[.pull-left[
  ![](materials/img/bashrc.png)
]]
.center[.pull-right[
  ![](materials/img/bash_profile.png)
]]
---
class:top
.pull-left[
Append the following to your `.bashrc` or `bash_profile`

```bash
export ALLOC=st-singha53-1
export SCRATCH_PATH=/scratch/$ALLOC/$USER
export PROJECT_PATH=/arc/project/$ALLOC/$USER
```

- You could also load modules here
- I mostly use `git`, `gcc`

```bash
module load gcc
module load git
```
]
.pull-right[
To make it work you need either of:
- `source ~/.bashrc`
- `source ~/.bash_profile`
- .secondary[It'r required to "reactivate" the configs]
- It's what it does behind the scenes when you login

.emphasis[
The `source` is only required when you want update right away. Bash auto source everytime you start it. 
]
]


--
<hr>
**More advanced usage**
- You could make `alias` for long commands, or hard to remember ones
```bash
alias la='ls -a'
alias h='history' # Prints list of commands you entered
# do not delete / or prompt if deleting more than 3 files at a time 
alias rm='rm -I --preserve-root'
# confirmation 
alias mv='mv -i'
alias cp='cp -i'
```
--
.secondary[Sorry, enough shell, let's go back to business]

---

# Job Submission

---

# VSC Setup

---

class: middle, center
background-image: url(materials/img/website_bkg.png)
background-position: top
background-size: contain

<br><br>
.secondary[.center[.larger[Thanks!]]]

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).

Credits to:

  [Stat 406 Lecture Slides @DJM](https://ubc-stat.github.io/stat-406/)

<br><br>

.secondary[.center[.larger[Questions?]]]
